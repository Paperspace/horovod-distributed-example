version: 1
type: "mpi"
filters:
  tags:
    only: 'v.*'
  branches:
    only: '.*'
master:
  container: "horovod/horovod:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6"
  command: "mpirun --allow-run-as-root -np 1 --hostfile /generated/hostfile  -bind-to none -map-by slot  -x NCCL_DEBUG=INFO -mca pml ob1 -mca btl ^openib python examples/keras_mnist.py"
  machine-type: "p2.xlarge"
  count: 1
worker:
  container: "horovod/horovod:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6"
  machine-type: "p2.xlarge"
  count: 2
model:
  type: Tensorflow
  path: '/shared/models'
checks:
  tensorflow:loss:
    target: 0.0..1.0
    aggregate: max
  tensorflow:accuracy:
    target: 0.988..1.000
    aggregate: median
  defaults:
    precision: 3